@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import controllers.auth.AuthenticatedRequest
@import play.api.i18n.Messages.Implicits._
@this(mainWithHeaders: views.html.main_with_headers, singleCheckbox26: helpers.SingleCheckbox26)
@(emailForm: Form[_], submitPrefsFormAction: Call)(implicit request: AuthenticatedRequest[_], messages: Messages)

@import uk.gov.hmrc.urls.Link
@import uk.gov.hmrc.play.views.html.helpers._
@import partial.paperless.tc.html._

@mainWithHeaders(title = Messages(s"tc_printing_preference.fg_page.title"), navTitle = Messages("tc_printing_preference.fg_page.nav_title")) {

    @problem(Seq(emailForm("termsAndConditions.opt-in").error.map(f => f -> "opt-in-in"), emailForm("termsAndConditions").error.map(f => f -> "termsAndConditions_accept-tc")).flatten)

    <header class="page-header">
        <h1 class="heading-large">@Messages(s"tc_printing_preference.fg_page.title")</h1>
    </header>

    <h3 class="lede" id="email-display">@Messages("tc_printing_preference.fg_page.email_address") @emailForm("email.main").value</h3>

    <p>@Messages("tc_printing_preference.fg_page.confirm_message_1")</p>
    <ul class="bullets">
        <li>@Messages("tc_printing_preference.fg_page.confirm_message_2")</li>
        <li>@Messages("tc_printing_preference.fg_page.confirm_message_3")</li>
    </ul>

    @form(action = submitPrefsFormAction, 'id -> "form-submit-email-address-tc") {
        <fieldset @if(emailForm("termsAndConditions.opt-in").error.isDefined) { class="form-field-group form-field-group--error" }>
            <div @if(emailForm("termsAndConditions").error.isDefined) { class="form-field--error" }>
                @emailForm("termsAndConditions").error.map { error =>
                    <label class="error-notification">@Messages(error.message)</label>
                }

                @singleCheckbox26(
                    emailForm("termsAndConditions.accept-tc"),
                    Html(Messages("tc_printing_preference.tc.preLinkText", Link.toExternalPage(id = Some("terms-and-conditions"), url = "https://www.tax.service.gov.uk/information/terms#secure", value = Some(Messages("tc_printing_preference.tc.linkText"))).toHtml)),
                    '_labelClass -> "label--inline"
                )
            </div>
        @emailForm("termsAndConditions.opt-in").errors.map { error => <label class="error-notification" style="display:inline-block">@Messages(error.message)</label>}
        <label class="selectable">
            <input
            id="opt-in-in"
            type="radio"
            name="termsAndConditions.opt-in"
            value="true"
            class="email-prefs__toggle"
                @if(emailForm("termsAndConditions.opt-in").value.contains("true")) { checked="checked" }
            />
            @Messages("tc_printing_preference.fg_page.store_email")
        </label>

            <input type="hidden" id="email.main" name="email.main" value="@emailForm("email.main").value">
        <input type="hidden" id="email.confirm" name="email.confirm" value="@emailForm("email.main").value">
        <input type="hidden" id="emailVerified" name="emailVerified" value="true">
        <input type="hidden" id="emailAlreadyStored" name="emailAlreadyStored" value="@emailForm("emailAlreadyStored").value" >

        <label class="selectable">
            <input
            id="opt-in-out"
            type="radio"
            name="termsAndConditions.opt-in"
            value="false"
            class="email-prefs__toggle lede"
                @if(emailForm("termsAndConditions.opt-in").value.contains("false")) { checked="checked" }
            />
            @Messages("tc_printing_preference.fg_page.do_not_store_email")
        </label>
        </fieldset>
        <br>
        <div class="form-field">
            <button id="submitEmailButton" class="button" name="submitButton" type="submit">@Messages("tc_printing_preference.submitButton")</button>
        </div>

    }

}
