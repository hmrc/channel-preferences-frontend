@(email : connectors.SaEmailPreference)(implicit request: Request[_])
@import connectors.SaEmailPreference
@import uk.gov.hmrc.urls.Link
@import uk.gov.hmrc.emailaddress.EmailAddress
@import uk.gov.hmrc.play.views.html.helpers._
@import controllers.sa.prefs.ExternalUrls._
@import views.sa.prefs.helpers.DateFormat._

<section class="divider--bottom">

    @if(email.status == SaEmailPreference.Status.pending) {
        <h2 id="saEmailRemindersHeader">Email for paperless notifications</h2>
    }
    @if(email.status == SaEmailPreference.Status.verified) {
        <h2 id="saEmailRemindersHeader">Email address for paperless notifications</h2>
    }

    @if(email.status == SaEmailPreference.Status.pending) {
        <p>You need to verify your email address.</p>
        <div class="indent">
            <p id="pending-status-message">An email was sent to <strong id="email-address">@{email.email}</strong> on @longDateFormat(email.linkSent). Click on the link in the email to verify your email address.</p>
        </div>
        @form(action = play.api.mvc.Call("POST", resendValidationUrl)){
                <p> If you can’t find it, we can <button id="resend-email-button" class="button--link-style" type="submit" data-journey-click="self-assessment-preferences-page:Click:Send a new verification email">send a new verification email</button></p>
        }
    }

    @if(email.status == SaEmailPreference.Status.verified ) {
        <p>Emails are sent to: <span id="email-address">@{EmailAddress(email.email).obfuscated}</span></p>
    }

    @if(email.status == SaEmailPreference.Status.bounced) {
        <p id="bouncing-status-message">You need to verify <span id="email-address">@{email.email}</span></p>

        @if(email.mailboxFull) {
            <p id="bounce-reason">The email telling you how to do this can’t be sent because your inbox is full.</p>
            <p id="bounce-reason-more">Clear your inbox or use a different email address.</p>
        } else {
            <p id="bounce-reason">The email telling you how to do this can’t be delivered.</p>
            <p>Use a different email address</p>
        }
    }

    <p>
    @Link.toInternalPage(
        id = if(email.status == SaEmailPreference.Status.bounced) Some("revalidate-email-link") else Some("change-email-address-link"),
        url = changeEmailAddress,
        value = Some("Change your email address"),
        dataAttributes = Some(Map("journey-click" -> "self-assessment-preferences:Click:Change your email address"))
    ).toHtml
    </p>
    <p>
    @Link.toInternalPage(
        id = Some("opt-out-of-email-link"),
        url = optOutOfEmailReminders,
        value = Some("Stop paperless notifications"),
        dataAttributes = Some(Map("journey-click" -> "self-assessment-preferences:Click:Stop paperless notifications"))
    ).toHtml
    </p>
</section>

