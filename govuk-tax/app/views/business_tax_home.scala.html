@(businessUser: controllers.BusinessUser)

@import views.formatting.Dates._
@import config.PortalConfig
@main(title = "Your tax home") {



    @if(businessUser.name != ""){
        <h2>Welcome @businessUser.name</h2>
    }
    <p>@if(!businessUser.previouslyLoggedInAt.isEmpty) {
        Last logged in on @formatEasyReadingTimestamp(businessUser.previouslyLoggedInAt, "")
    } else {
        First ever login
    }</p>

    @if(businessUser.utr.isDefined) {
        <p>UTR: @businessUser.utr.get</p>
    } <q></q>

    @if(businessUser.vrn.isDefined) {
        <p>VRN: @businessUser.vrn.get</p>
    }

    @if(businessUser.regimeRoots.hasBusinessTaxRegime) {
        <p>Services you have enrolled for and activated via the Government Gateway:</p>
        <ul style="list-style-type:none;">
            @if(businessUser.regimeRoots.sa.isDefined){
            <li><a href="/sa/details">Self-assessment (SA)</a></li>
            }
            @if(businessUser.regimeRoots.vat.isDefined){
            <li><a href="#">Value Added Tax (VAT)</a></li>
            }

        </ul>
    } else {
        <p>You are not currently actively enrolled for any online services</p>
    }

        <ul style="list-style-type:none;">
            <li><a id="portalLink" href="@PortalConfig.destinationRoot/home">Take me to the portal....</a></li>
        </ul>
}

<script language="javascript">

    var link = document.getElementById("portalLink");

    var destinationAddress = link.href;
    var ssoUrl = "@PortalConfig.ssoUrl";
    var gatewayToken = "@businessUser.encodedGovernmentGatewayToken";
    var nowTimestamp = new Date().getTime();

    link.onclick = function()
    {
        var form = document.createElement('form');
        form.method = 'post';
        form.action = ssoUrl;

        var gw = document.createElement('input');
        gw.type = 'hidden';
        gw.name = 'gw';
        gw.value = gatewayToken;

        var dest = document.createElement('input');
        dest.type = 'hidden';
        dest.name = 'dest';
        dest.value = destinationAddress;

        var time = document.createElement('input');
        time.type = 'hidden';
        time.name = 'time';
        time.value = nowTimestamp;

        document.body.appendChild(form);
        form.appendChild(gw);
        form.appendChild(dest);
        form.appendChild(time);

        // POST form
        form.submit();

        // cancel link click event if everything is successful
        return false;
    }

</script>
