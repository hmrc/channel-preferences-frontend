@(saPreferences : Option[uk.gov.hmrc.common.microservice.preferences.SaPreference])(implicit user: uk.gov.hmrc.common.microservice.domain.User, request: Request[_])
@import uk.gov.hmrc.common.microservice.preferences.SaEmailPreference
@import uk.gov.hmrc.domain.Email._

@main(title = "Your details", nav = true, user= Some(user)) {
    <header class="page-header">
        <h1>Your details</h1>

        <h2> Self Assessment email reminders </h2>
    </header>
   @if(saPreferences.isDefined && saPreferences.get.digital) {

       @if(saPreferences.get.email.get.status == SaEmailPreference.Status.pending) {
           <p id="pending-status-message">You signed up for email reminders but you must verify your email address to activate the service.</p>

           @helpers.form(action = controllers.bt.routes.AccountDetailsController.resendValidationEmail) {

           <div class="form-field">
               <p>
               <button id="resend-email-button" class="button" type="submit">Verify your email address</button>
               </p>
           </div>

           }

           <p>
           @helpers.link(
               "change-email-address-link",
               controllers.bt.routes.AccountDetailsController.changeEmailAddress(None).url,
               "Change your email address"
           )
           </p>
       }

       @if(saPreferences.get.email.get.status == SaEmailPreference.Status.verified ) {
           <p>Youâ€™re signed up for email reminders for when tax returns and payments are due and tax statements are online.</p>
           <p>Email address: <span id="email-address">@{saPreferences.get.email.get.email.obfuscated}</span></p>
           <hr>
           <p>
           @helpers.link(
                    "change-email-address-link",
                     controllers.bt.routes.AccountDetailsController.changeEmailAddress(None).url,
                     "Change your email address"
                )
           </p>
       }
       @if(saPreferences.get.email.get.status == SaEmailPreference.Status.bounced) {
           <p id="bouncing-status-message">You are currently opted-in to Digital SA, but the last email we sent you was not deliverable, we received the following error:</p>
           <p id="bounce-reason">@{saPreferences.get.email.get.message.getOrElse("Error message is unavailable")}</p>
           <p>
           @helpers.link(
               "revalidate-email-link",
               controllers.bt.routes.AccountDetailsController.changeEmailAddress(None).url,
               "Change / re-validate your email address"
           )
           </p>
       }

       <p>
       @helpers.link(
           "opt-out-of-email-link",
           controllers.bt.routes.AccountDetailsController.optOutOfEmailReminders.url,
           "Stop your email reminders"
       )
       </p>


   }
    @if(saPreferences.isDefined && !saPreferences.get.digital) {
        <p id="opt-out-status-message">You are currently opted-out of Digital SA, use the link below to manage your preferences.</p>

        <p>
        @helpers.link(
            "opt-in-to-digital-email-link",
            controllers.bt.prefs.routes.SaPrefsController.displayPrefsForm(None).url,
            "Opt-in to email reminders"
        )
        </p>


    }

}