@(saPreferences : Option[uk.gov.hmrc.common.microservice.preferences.SaPreference])(implicit user: uk.gov.hmrc.common.microservice.domain.User, request: Request[_])
@import uk.gov.hmrc.common.microservice.preferences.SaEmailPreference
@import uk.gov.hmrc.domain.Email._
@import views.helpers.Link

@main(title = "Your details", nav = true, user= Some(user)) {
    <header class="page-header">
        <h1>Your details</h1>

        <h2> Self Assessment email reminders </h2>
    </header>
   @if(saPreferences.isDefined && saPreferences.get.digital) {

       @if(saPreferences.get.email.get.status == SaEmailPreference.Status.pending) {
           <p id="pending-status-message">You signed up for email reminders but you must verify your email address to activate the service.</p>
           <p>Email address: <span id="email-address">@{saPreferences.get.email.get.email}</span></p>

           @helpers.form(action = controllers.bt.routes.AccountDetailsController.resendValidationEmail) {

           <div class="form-field">
               <p>
               <button id="resend-email-button" class="button" type="submit">Verify your email</button>
               </p>
           </div>

           }

           <p>
           @Link.toInternalPage(
               id = Some("change-email-address-link"),
               url = controllers.bt.routes.AccountDetailsController.changeEmailAddress(None).url,
               value = Some("Change your email address")
           ).toHtml
           </p>
       }

       @if(saPreferences.get.email.get.status == SaEmailPreference.Status.verified ) {
           <p>You’re signed up for email reminders for when tax returns and payments are due and tax statements are online.</p>
           <p>They’re sent to: <span id="email-address">@{saPreferences.get.email.get.email.obfuscated}</span></p>
           <hr>
           <p>
           @Link.toInternalPage(
                id = Some("change-email-address-link"),
                url = controllers.bt.routes.AccountDetailsController.changeEmailAddress(None).url,
                value = Some("Change your email address")
           ).toHtml
           </p>
       }
       @if(saPreferences.get.email.get.status == SaEmailPreference.Status.bounced) {

           <p id="bouncing-status-message">You’ve signed up for email reminders but we need to verify your email address - <span id="email-address">@{saPreferences.get.email.get.email}</span></p>
           <p id="bounce-reason">We can’t do this because @{saPreferences.get.email.get.message.getOrElse("Error message is unavailable")}</p>
           <p>
           @Link.toInternalPage(
               id = Some("revalidate-email-link"),
               url = controllers.bt.routes.AccountDetailsController.changeEmailAddress(None).url,
               value = Some("Change your email address")
           ).toHtml
           </p>
       }

       <p>
       @Link.toInternalPage(
           id = Some("opt-out-of-email-link"),
           url = controllers.bt.routes.AccountDetailsController.optOutOfEmailReminders.url,
           value = Some("Stop your email reminders")
       ).toHtml
       </p>


   }
    @if(saPreferences.isDefined && !saPreferences.get.digital) {
        <p id="opt-out-status-message">You can sign up for Self Assessment email reminders for when tax returns and payments are due and tax statements are online.</p>

        <p>
        @Link.toInternalPage(
            id = Some("opt-in-to-digital-email-link"),
            url = controllers.bt.prefs.routes.SaPrefsController.displayPrefsForm(None).url,
            value = Some("Sign up for Self Assessment email reminders")
        ).toHtml
        </p>


    }

}