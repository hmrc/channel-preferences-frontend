@(formItem:Form[_], fields: Seq[views.helpers.FormField], args: (Symbol,Any)*)(implicit lang: play.api.i18n.Lang)

@import play.api.i18n._
@import views.html.helper._
@import views.helpers._


@allFieldElements = @{ fields.map{ f => new FieldElements(f.field.id, f.field, null, args.toMap, lang) } }
@anyFieldHasError = @{ allFieldElements.exists( _.hasErrors ) }
@argsMap = @{ args.toMap }
@valueAfter = @{ argsMap.get('_valueAfter).getOrElse(false).asInstanceOf[Boolean] }

<div class="@argsMap.get('_groupDivClass) @if(anyFieldHasError) {error}">
    <p>@Html(allFieldElements(0).label.toString())</p>
    @if(argsMap.contains('_additionalTitleText)){<p>@argsMap.get('_additionalTitleText)</p>}
    @for(elements <- allFieldElements) {
        @elements.errors.map { error => <span class="error-notification">@Messages(error)</span> }
    }
    @for(field <- fields) {
        @for(input <- field.inputs) {

             @input match {
                case dateControl: DateControl => {
                    @dateFieldsInline(formItem, field.field.id, "", dateControl.yearRange)
                }
                case inputType: InputType => {
                        @defining(field.field.value match { case Some(x) => x case None => "" case x => x }) { currentValue =>
                        @defining(field.field.name + (if(inputType.key != ""){"-"+ inputType.key} else ""))  { inputId =>
                        <div class='@inputType.divClass.getOrElse("")'>
                            <label for="@inputId" class='@inputType.labelClass.getOrElse("")'>
                                @if(inputType.label.isDefined) {@inputType.label}
                                @if(!valueAfter) { @inputType.value }
                                <input type="@inputType.inputType"
                                        id="@inputId"
                                        class="@inputType.inputClass"
                                        name="@field.field.name"
                                        value="@{inputType.inputType match {
                                           case "radio" => inputType.key
                                           case "checkbox" => "true"
                                           case _ => currentValue
                                            }}"

                                        @if(inputType.inputType == "radio") {
                                            @if(currentValue==inputType.key){checked="checked"}
                                        }
                                        @if(inputType.inputType == "checkbox"){
                                            @if(currentValue=="true"){checked="checked"}
                                        }
                                />
                                @if(valueAfter) { @inputType.value }
                            </label>
                        </div>
                        }}
                    }
             }
        }
    }
</div>
